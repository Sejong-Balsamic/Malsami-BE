<div th:fragment="tokenValidation">
  <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
      const accessToken = localStorage.getItem('accessToken');
      const currentPath = window.location.pathname;
      console.log('현재 accessToken:', accessToken);
      console.log('현재 경로:', currentPath);

      if (currentPath === '/login') {
        return;
      }

      if (!accessToken) {
        console.log('accessToken 없음. /login으로 리다이렉트.');
        window.location.href = '/login';
        return;
      }

      const formData = new FormData();
      formData.append('accessToken', accessToken);

      fetch('/api/auth/validate', {
        method: 'POST',
        body: formData
      })
      .then(response => {
        console.log('validate 응답 상태:', response.status);
        if (!response.ok) {
          throw new Error('Token validation failed');
        }
      })
      .catch(error => {
        console.error('Token validation error:', error);
        localStorage.removeItem('accessToken');
        window.location.href = '/login';
      });
    });
  </script>
</div>