<!-- src/main/resources/templates/admin/dashboard.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head(title='Dashboard')">
</head>
<body class="dashboard-page">
<!-- Ìó§Îçî Ìè¨Ìï® -->
<div th:replace="fragments/header :: header"></div>

<!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
<div class="ui container u-margin-vertical-large u-padding-horizontal-medium">

  <!-- ÎåÄÏãúÎ≥¥Îìú Ï†úÎ™© -->
  <div class="ui main text container u-margin-bottom-large"
       style="position: relative; display: flex; align-items: center;">
    <h1 class="ui header" id="dashboardTitle"
        style="cursor: pointer; display: inline-block; position: relative; margin-right: 10px;">
      <span>üéØDASHBOARD</span>
    </h1>
    <img id="playgroundIcon" src="/images/play-ground.png"
         style="width:42px; height:45px; cursor:pointer; margin-left:10px; position:relative; transition: transform
         0.3s ease;"/>
    <a id="devPlaygroundButton" href="javascript:Auth.navigate('/admin/play-ground')" class="ui pink icon tiny button"
       style="display:none;">
      üé™Í∞úÎ∞úÏûê ÎÜÄÏù¥ÌÑ∞
    </a>
  </div>

  <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÏÑπÏÖò -->
  <div class="ui segment">
    <h3 class="ui header">
      <i class="cogs icon"></i>
      Í¥ÄÎ¶¨ Î©îÎâ¥
    </h3>

    <div class="ui card fluid">
      <div class="content">
        <div class="ui five column stackable grid u-margin-bottom-large u-display-mobile-flex"
             style="max-width: 1200px; margin: 0 auto;">
          <div class="column">
            <a href="javascript:Auth.navigate('/admin/member')" class="ui blue icon labeled button">
              <i class="users icon"></i>
              ÌöåÏõê
            </a>
          </div>
          <div class="column">
            <a href="javascript:Auth.navigate('/admin/yeopjeon')" class="ui yellow icon labeled button">
              <i class="circle outline icon"></i>
              <span style="color: black">ÏóΩÏ†Ñ</span>
            </a>
          </div>
          <div class="column">
            <a href="javascript:Auth.navigate('/admin/test')" class="ui black icon labeled button">
              <i class="flask icon"></i>
              ÌÖåÏä§Ìä∏Ïö©
            </a>
          </div>
          <div class="column">
            <a href="/admin/courses" class="ui green icon labeled button">
              <i class="book icon"></i>
              ÍµêÍ≥ºÎ™©
            </a>
          </div>
          <div class="column">
            <a href="/admin/questionPosts" class="ui orange icon labeled button">
              <i class="question circle icon"></i>
              Q&A
            </a>
          </div>
          <div class="column">
            <a href="/admin/resources" class="ui purple icon labeled button">
              <i class="file alternate icon"></i>
              ÏûêÎ£åÏã§
            </a>
          </div>
          <div class="column">
            <a href="/admin/notices" class="ui red icon labeled button">
              <i class="announcement icon"></i>
              Í≥µÏßÄÏÇ¨Ìï≠
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Í≤ΩÍ≥† ÏïåÎ¶º ÏÑπÏÖò -->
  <div id="alerts-section" class="u-display-none u-margin-bottom-large">
    <div class="ui icon warning message">
      <i class="warning sign icon"></i>
      <div class="content">
        <div class="header">ÏãúÏä§ÌÖú Í≤ΩÍ≥†</div>
        <div id="alerts-list"></div>
      </div>
    </div>
  </div>

  <!-- ÌÜµÍ≥Ñ Í∞úÏöî ÏÑπÏÖò -->
  <div class="ui statistics-overview segments u-margin-bottom-large">
    <div class="ui segment">
      <h3 class="ui header">
        <i class="chart line icon"></i>
        Ïã§ÏãúÍ∞Ñ ÌÜµÍ≥Ñ
      </h3>
      <div class="ui five stackable cards">
        <!-- ÌÜµÍ≥Ñ Î°úÎî© ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî -->
        <div class="card" id="statistics-placeholder">
          <div class="content">
            <div class="ui placeholder">
              <div class="header">
                <div class="line"></div>
              </div>
              <div class="paragraph">
                <div class="line"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ïã§Ï†ú ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§ -->
        <div class="ui cards" id="statistics-data" style="display: none;">
          <!-- ÌöåÏõê ÌÜµÍ≥Ñ Ïπ¥Îìú -->
          <div class="card">
            <div class="content">
              <div class="ui tiny statistics">
                <div class="statistic">
                  <div class="value" id="memberCount">0</div>
                  <div class="label">Ï¥ù ÌöåÏõê</div>
                </div>
                <div class="statistic">
                  <div class="value" id="activeUsers">0</div>
                  <div class="label">ÌôúÏÑ± ÏÇ¨Ïö©Ïûê</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Í≤åÏãúÎ¨º ÌÜµÍ≥Ñ Ïπ¥Îìú -->
          <div class="card">
            <div class="content">
              <div class="ui tiny statistics">
                <div class="statistic">
                  <div class="value" id="totalPosts">0</div>
                  <div class="label">Ï†ÑÏ≤¥ Í≤åÏãúÎ¨º</div>
                </div>
                <div class="statistic">
                  <div class="value" id="todayPosts">0</div>
                  <div class="label">Ïò§Îäò ÏûëÏÑ±</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Ï∂îÍ∞Ä ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§... -->
        </div>
      </div>
    </div>

    <!-- Ï∞®Ìä∏ ÏÑπÏÖò -->
    <div class="ui stackable two column grid u-margin-bottom-large">
      <!-- Ï£ºÍ∞Ñ ÌôúÎèô Ï∞®Ìä∏ -->
      <div class="column">
        <div class="ui segment">
          <h4 class="ui header">
            <i class="chart bar icon"></i>
            Ï£ºÍ∞Ñ ÌôúÎèô ÌÜµÍ≥Ñ
          </h4>
          <div class="chart-container u-padding-vertical-small">
            <canvas id="weeklyActivityChart" height="200"></canvas>
            <!-- Î°úÎî© ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî -->
            <div class="ui placeholder chart-placeholder">
              <div class="rectangular image"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ÏÇ¨Ïö©Ïûê Î∂ÑÌè¨ Ï∞®Ìä∏ -->
      <div class="column">
        <div class="ui segment">
          <h4 class="ui header">
            <i class="pie chart icon"></i>
            ÏÇ¨Ïö©Ïûê Î∂ÑÌè¨
          </h4>
          <div class="chart-container u-padding-vertical-small">
            <canvas id="userDistributionChart" height="200"></canvas>
            <!-- Î°úÎî© ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî -->
            <div class="ui placeholder chart-placeholder">
              <div class="rectangular image"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§ Î™®ÎãàÌÑ∞ÎßÅ ÏÑπÏÖò -->
    <div class="ui segment u-margin-bottom-large">
      <h3 class="ui header">
        <i class="server icon"></i>
        ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§ Î™®ÎãàÌÑ∞ÎßÅ
      </h3>
      <div class="ui three column stackable grid">
        <!-- CPU ÏÇ¨Ïö©Îüâ -->
        <div class="column">
          <div class="ui segment">
            <div class="ui tiny statistics">
              <div class="statistic">
                <div class="value">
                  <div id="cpuGauge"></div>
                </div>
                <div class="label">CPU ÏÇ¨Ïö©Îüâ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ -->
        <div class="column">
          <div class="ui segment">
            <div class="ui tiny statistics">
              <div class="statistic">
                <div class="value">
                  <div id="memoryGauge"></div>
                </div>
                <div class="label">Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ÎîîÏä§ÌÅ¨ ÏÇ¨Ïö©Îüâ -->
        <div class="column">
          <div class="ui segment">
            <div class="ui tiny statistics">
              <div class="statistic">
                <div class="value">
                  <div id="diskGauge"></div>
                </div>
                <div class="label">ÎîîÏä§ÌÅ¨ ÏÇ¨Ïö©Îüâ</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ÏµúÍ∑º Í≤ΩÍ≥† Î°úÍ∑∏ ÏÑπÏÖò -->
    <div class="ui segment">
      <h3 class="ui header">
        <i class="exclamation triangle icon"></i>
        ÏµúÍ∑º Í≤ΩÍ≥† Î°úÍ∑∏
      </h3>
      <div class="ui relaxed divided list" id="warningLogs">
        <!-- Î°úÎî© ÌîåÎ†àÏù¥Ïä§ÌôÄÎçî -->
        <div class="ui placeholder">
          <div class="line"></div>
          <div class="line"></div>
          <div class="line"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- Ìë∏ÌÑ∞ Ìè¨Ìï® -->
  <div th:replace="fragments/footer :: footer"></div>
</body>
<!-- Chart.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

<!-- ÎåÄÏãúÎ≥¥Îìú Ïä§ÌÅ¨Î¶ΩÌä∏ -->
<script th:inline="javascript">
  $(document).ready(function () {
    // Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî
    initializeCharts();

    // ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    loadStatistics();

    // ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§ Î™®ÎãàÌÑ∞ÎßÅ ÏãúÏûë
    startSystemMonitoring();

    // Í≤ΩÍ≥† Î°úÍ∑∏ Î°úÎìú
    loadWarningLogs();

    // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏÑ§Ï†ï
    setInterval(loadStatistics, 300000); // 5Î∂Ñ
    setInterval(updateSystemResources, 5000); // 5Ï¥à
  });

  function initializeCharts() {
    // Ï£ºÍ∞Ñ ÌôúÏÑ±Ìôî Ï∞®Ìä∏
    const weeklyCtx = document.getElementById('weeklyActivityChart').getContext('2d');
    window.weeklyChart = new Chart(weeklyCtx, {
      type: 'line',
      data: {
        labels: ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'],
        datasets: [{
          label: 'ÌôúÎèôÎüâ',
          data: [0, 0, 0, 0, 0, 0, 0],
          borderColor: 'rgb(75, 192, 192)',
          tension: 0.1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: true
          }
        },
        scales: {
          x: {
            display: true,
            title: {
              display: true,
              text: 'ÏöîÏùº'
            }
          },
          y: {
            display: true,
            title: {
              display: true,
              text: 'ÌôúÎèôÎüâ'
            },
            beginAtZero: true
          }
        }
      }
    });

    // ÏÇ¨Ïö©Ïûê Î∂ÑÌè¨ Ï∞®Ìä∏
    const distributionCtx = document.getElementById('userDistributionChart').getContext('2d');
    window.distributionChart = new Chart(distributionCtx, {
      type: 'doughnut',
      data: {
        labels: ['ÌôúÏÑ±', 'Ìú¥Î©¥', 'Ïã†Í∑ú'],
        datasets: [{
          data: [0, 0, 0],
          backgroundColor: [
            'rgb(54, 162, 235)',
            'rgb(255, 99, 132)',
            'rgb(75, 192, 192)'
          ]
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }

  function loadStatistics() {
    $.ajax({
      url: '/api/admin/statistics',
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
      },
      success: function (response) {
        updateStatisticsDisplay(response);
        updateCharts(response);
        $('#statistics-placeholder').hide();
        $('#statistics-data').show();
      },
      error: function (xhr, status, error) {
        console.error('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
        showError('ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
      }
    });
  }

  function startSystemMonitoring() {
    updateSystemResources();
  }

  function updateSystemResources() {
    $.ajax({
      url: '/api/admin/system-resources',
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
      },
      success: function (response) {
        updateResourceGauges(response);
        checkResourceWarnings(response);
      },
      error: function (xhr, status, error) {
        console.error('ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§ Î™®ÎãàÌÑ∞ÎßÅ Ïã§Ìå®:', error);
      }
    });
  }

  function updateResourceGauges(data) {
    // CPU Í≤åÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
    $('#cpuGauge').text(`${data.cpuUsage}%`).removeClass('red green yellow').addClass(
        data.cpuUsage > 80 ? 'red' : 'green');

    // Î©îÎ™®Î¶¨ Í≤åÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
    $('#memoryGauge').text(`${data.memoryUsage}%`).removeClass('red green yellow').addClass(
        data.memoryUsage > 80 ? 'red' : 'green');

    // ÎîîÏä§ÌÅ¨ Í≤åÏù¥ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
    $('#diskGauge').text(`${data.diskUsage}%`).removeClass('red green yellow').addClass(
        data.diskUsage > 80 ? 'red' : 'green');
  }

  function checkResourceWarnings(data) {
    let warnings = [];

    if (data.cpuUsage > 80) {
      warnings.push('CPU ÏÇ¨Ïö©ÎüâÏù¥ 80%Î•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.');
    }
    if (data.memoryUsage > 80) {
      warnings.push('Î©îÎ™®Î¶¨ ÏÇ¨Ïö©ÎüâÏù¥ 80%Î•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.');
    }
    if (data.diskUsage > 80) {
      warnings.push('ÎîîÏä§ÌÅ¨ ÏÇ¨Ïö©ÎüâÏù¥ 80%Î•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.');
    }

    if (warnings.length > 0) {
      showWarnings(warnings);
    } else {
      $('#alerts-section').hide();
    }
  }

  function showWarnings(warnings) {
    const alertsList = $('#alerts-list');
    alertsList.empty();

    warnings.forEach(warning => {
      alertsList.append(`
          <div class="ui warning message">
            <i class="warning icon"></i>
            ${warning}
          </div>
        `);
    });

    $('#alerts-section').show();
  }

  function loadWarningLogs() {
    $.ajax({
      url: '/api/admin/warning-logs',
      method: 'GET',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
      },
      success: function (response) {
        updateWarningLogs(response);
      },
      error: function (xhr, status, error) {
        console.error('Í≤ΩÍ≥† Î°úÍ∑∏ Î°úÎìú Ïã§Ìå®:', error);
      }
    });
  }

  function updateWarningLogs(logs) {
    const logsContainer = $('#warningLogs');
    logsContainer.empty();

    logs.forEach(log => {
      logsContainer.append(`
          <div class="item">
            <i class="large warning circle middle aligned icon"></i>
            <div class="content">
              <div class="header">${log.title}</div>
              <div class="description">${log.message}</div>
              <div class="meta">
                <span class="date">${log.timestamp}</span>
              </div>
            </div>
          </div>
        `);
    });
  }

  function updateStatisticsDisplay(data) {
    $('#memberCount').text(data.totalMembers);
    $('#activeUsers').text(data.activeUsers);
    $('#totalPosts').text(data.totalPosts);
    $('#todayPosts').text(data.todayPosts);
    // Ï∂îÍ∞Ä ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏...
  }

  function updateCharts(data) {
    // Ï£ºÍ∞Ñ ÌôúÏÑ±Ìôî Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    window.weeklyChart.data.datasets[0].data = data.weeklyActivity;
    window.weeklyChart.update();

    // ÏÇ¨Ïö©Ïûê Î∂ÑÌè¨ Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
    window.distributionChart.data.datasets[0].data = [data.activeUsers, data.dormantUsers, data.newUsers];
    window.distributionChart.update();
  }

  function showError(message) {
    console.error(message);
  }

  // Í∏∞Ï°¥ title ÌÅ¥Î¶≠ Î°úÏßÅ
  let titleClickCount = 0;
  let lastTitleClickTime = 0;
  const titleClickResetTime = 3000; // 3Ï¥à
  let currentPosition = 0;
  const moveDistance = 20; // Ìïú Î≤àÏóê Ïù¥ÎèôÌï† Í±∞Î¶¨ (ÌîΩÏÖÄ)
  const maxMoves = 3; // ÏµúÎåÄ Ïù¥Îèô ÌöüÏàò

  document.addEventListener('DOMContentLoaded', function () {
    const playgroundIcon = document.getElementById('playgroundIcon');
    const devPlaygroundButton = document.getElementById('devPlaygroundButton');
    let clickCount = 0;
    let offset = 0; // ÏïÑÏù¥ÏΩòÏù¥ Ïù¥ÎèôÌï† ÏúÑÏπòÍ∞í

    playgroundIcon.addEventListener('click', function () {
      clickCount++;
      if (clickCount % 2 === 1) {
        offset = 50;
      } else {
        offset = 20;
      }
      playgroundIcon.style.transform = `translateX(${offset}px)`;

      if (clickCount === 5) {
        devPlaygroundButton.style.display = 'inline-block';
        devPlaygroundButton.style.transform = 'scale(0)';
        devPlaygroundButton.style.transition = 'transform 0.3s ease';
        requestAnimationFrame(() => {
          devPlaygroundButton.style.transform = 'scale(1)';
        });
        playgroundIcon.style.display='none';
      }
    });
  });
</script>
</html>
